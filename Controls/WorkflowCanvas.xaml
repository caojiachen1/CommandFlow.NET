<UserControl x:Class="CommandFlow.NET.Controls.WorkflowCanvas"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:CommandFlow.NET.Controls"
             AllowDrop="True"
             Background="Transparent"
             ClipToBounds="True">
    <Grid>
        <!-- 网格背景 -->
        <Canvas x:Name="GridCanvas" IsHitTestVisible="False">
            <Canvas.Background>
                <DrawingBrush TileMode="Tile" Viewport="0,0,20,20" ViewportUnits="Absolute">
                    <DrawingBrush.Drawing>
                        <GeometryDrawing>
                            <GeometryDrawing.Geometry>
                                <GeometryGroup>
                                    <RectangleGeometry Rect="0,0,20,20"/>
                                </GeometryGroup>
                            </GeometryDrawing.Geometry>
                            <GeometryDrawing.Pen>
                                <Pen Brush="#20808080" Thickness="0.5"/>
                            </GeometryDrawing.Pen>
                        </GeometryDrawing>
                    </DrawingBrush.Drawing>
                </DrawingBrush>
            </Canvas.Background>
        </Canvas>

        <!-- 缩放和平移变换容器 -->
        <Canvas x:Name="TransformCanvas">
            <Canvas.RenderTransform>
                <TransformGroup>
                    <ScaleTransform x:Name="ScaleTransform" ScaleX="1" ScaleY="1"/>
                    <TranslateTransform x:Name="TranslateTransform"/>
                </TransformGroup>
            </Canvas.RenderTransform>

            <!-- 连接线层 -->
            <Canvas x:Name="ConnectionLayer"/>

            <!-- 节点层 -->
            <Canvas x:Name="NodeLayer"/>

            <!-- 临时连接线 -->
            <Path x:Name="TempConnectionLine"
                  Stroke="{DynamicResource AccentFillColorDefaultBrush}"
                  StrokeThickness="2"
                  StrokeDashArray="4,2"
                  Visibility="Collapsed"/>
        </Canvas>
    </Grid>
</UserControl>
